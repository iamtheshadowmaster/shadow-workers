---
interface Slide {
  title: string;
  gradients: string;
  iconGradients: string;
}

interface Props {
  title: string;
  subtitle: string;
  category: string;
  slides: Slide[];
  backgroundColor?: string;
}

const { title, subtitle, category, slides, backgroundColor = "bg-gradient-to-b from-black to-gray-900" } = Astro.props;
---

<section class={`py-32 ${backgroundColor}`}>
  <div class="max-w-4xl mx-auto px-6 text-center">
    <h2 class="text-4xl md:text-5xl font-bold text-white mb-6">{title}</h2>
    <p class="text-xl text-gray-300 mb-20">{subtitle}</p>
    
    <!-- Integrated Slideshow -->
    <div class="slideshow-container" data-category={category}>
      <!-- Navigation -->
      <div class="flex items-center justify-center mb-8 space-x-6">
        <button class="nav-arrow nav-prev" data-direction="prev">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m15 18-6-6 6-6"/>
          </svg>
        </button>
        
        <!-- Slide Indicators -->
        <div class="flex space-x-2">
          {slides.map((_, index) => (
            <button class={`indicator ${index === 0 ? 'active' : ''}`} data-slide={index.toString()}>
              <div class="indicator-progress"></div>
            </button>
          ))}
        </div>
        
        <button class="nav-arrow nav-next" data-direction="next">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m9 18 6-6-6-6"/>
          </svg>
        </button>
      </div>
      
      <div class="slides-wrapper">
        {slides.map((slide, index) => (
          <div class={`slide ${index === 0 ? 'active' : ''}`}>
            <!-- Title -->
            <h3 class="text-2xl font-bold text-white mb-8 text-center">{slide.title}</h3>
            
            <!-- Video/Demo -->
            <div class={`bg-gradient-to-br ${slide.gradients} rounded-3xl p-6 shadow-2xl`}>
              <div class="bg-black/50 backdrop-blur rounded-2xl aspect-video flex items-center justify-center">
                <div class="text-center">
                  <div class={`w-16 h-16 bg-gradient-to-br ${slide.iconGradients} rounded-2xl flex items-center justify-center mb-4 mx-auto`}>
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>
                  <p class="text-gray-300">Watch Demo</p>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  .slideshow-container {
    position: relative;
    max-width: 100%;
  }
  
  .slides-wrapper {
    position: relative;
    overflow: hidden;
    height: auto;
  }
  
  .slide {
    display: none;
    transform: translateX(30px);
    opacity: 0;
    transition: all 0.4s ease;
  }
  
  .slide.active {
    display: block;
    transform: translateX(0);
    opacity: 1;
  }
  
  /* Navigation Arrows */
  .nav-arrow {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.06);
    border: none;
    color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .nav-arrow:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
    transform: scale(1.1);
  }
  
  .nav-arrow:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  
  .nav-arrow svg {
    width: 12px;
    height: 12px;
  }
  
  /* Indicator Dots */
  .indicator {
    position: relative;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.3);
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }
  
  .indicator:hover {
    background-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
  }
  
  .indicator.active {
    background-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.2);
  }
  
  /* Progress animation inside dots */
  .indicator-progress {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.9);
    transform: scale(0);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .indicator.active .indicator-progress {
    animation: progressFill 15s linear;
  }
  
  @keyframes progressFill {
    0% {
      transform: scale(0);
    }
    100% {
      transform: scale(1);
    }
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .slide.active h3 {
    animation: slideIn 0.6s ease-out 0.2s both;
  }
  
  .slide.active > div {
    animation: slideIn 0.6s ease-out 0.4s both;
  }
</style>

<script>
  class Slideshow {
    container: Element;
    slides: NodeListOf<Element>;
    indicators: NodeListOf<Element>;
    navArrows: NodeListOf<Element>;
    currentSlide: number;
    interval: number | null;
    isTransitioning: boolean;

    constructor(container: Element) {
      this.container = container;
      this.slides = container.querySelectorAll('.slide');
      this.indicators = container.querySelectorAll('.indicator');
      this.navArrows = container.querySelectorAll('.nav-arrow');
      this.currentSlide = 0;
      this.interval = null;
      this.isTransitioning = false;
      
      this.init();
    }
    
    init(): void {
      // Indicator clicks
      this.indicators.forEach((indicator: Element, index: number) => {
        indicator.addEventListener('click', () => {
          if (!this.isTransitioning) {
            this.goToSlide(index);
          }
        });
      });
      
      // Arrow navigation
      this.navArrows.forEach((arrow: Element) => {
        arrow.addEventListener('click', () => {
          if (!this.isTransitioning) {
            const direction = arrow.getAttribute('data-direction');
            if (direction === 'next') {
              this.nextSlide();
            } else if (direction === 'prev') {
              this.prevSlide();
            }
          }
        });
      });
      
      this.startAutoAdvance();
      
      this.container.addEventListener('mouseenter', () => this.stopAutoAdvance());
      this.container.addEventListener('mouseleave', () => this.startAutoAdvance());
    }
    
    goToSlide(index: number): void {
      if (index === this.currentSlide || this.isTransitioning) return;
      
      this.isTransitioning = true;
      
      // Remove active states
      this.slides[this.currentSlide].classList.remove('active');
      this.indicators[this.currentSlide].classList.remove('active');
      
      this.currentSlide = index;
      
      // Add active states
      this.slides[this.currentSlide].classList.add('active');
      this.indicators[this.currentSlide].classList.add('active');
      
      // Reset transition flag after animation completes
      setTimeout(() => {
        this.isTransitioning = false;
      }, 400);
    }
    
    nextSlide(): void {
      const nextIndex = (this.currentSlide + 1) % this.slides.length;
      this.goToSlide(nextIndex);
    }
    
    prevSlide(): void {
      const prevIndex = (this.currentSlide - 1 + this.slides.length) % this.slides.length;
      this.goToSlide(prevIndex);
    }
    
    startAutoAdvance(): void {
      this.stopAutoAdvance();
      this.interval = setInterval(() => {
        if (!this.isTransitioning) {
          this.nextSlide();
        }
      }, 15000) as unknown as number;
    }
    
    stopAutoAdvance(): void {
      if (this.interval) {
        clearInterval(this.interval);
        this.interval = null;
      }
    }
  }
  
  function initializeSlideshows(): void {
    const slideshowContainers = document.querySelectorAll('.slideshow-container');
    slideshowContainers.forEach((container: Element) => {
      new Slideshow(container);
    });
  }
  
  document.addEventListener('DOMContentLoaded', initializeSlideshows);
  
  if (document.readyState !== 'loading') {
    initializeSlideshows();
  }
</script>