---
const features = [
  {
    title: 'Tasks piling up automatically',
    subtitle: 'Connect your daily tools and see tasks magically appear',
    description: 'Forget manual task management—Shadow understands your priorities and automatically creates a dynamic, real-time to-do list for you. No input needed, just clarity and focus.',
    isTaskList: true,
    tasks: [
      { label: 'Answer Corp\'s RFP', tag: 'Sales', urgent: true },
      { label: 'Review Matt\'s pitchdeck', tag: 'Sales' },
      { label: 'Prepare Tom\'s weekly meeting', tag: 'HR' }
    ]
  },
  {
    title: 'Tasks done automatically',
    subtitle: 'Frees your time for real',
    description: 'Shadow executes routine tasks for you, like magic. Scheduling, follow-ups, 1.1 preps, email recap: let Shadow handle the repetitive so you can focus on the impactful.',
    isAutoTask: true,
    task: {
      title: "Prepare 1.1 weekly sales call",
      tag: "HR",
    }
  },
  {
    title: 'You in the loop',
    subtitle: 'Ready-to-go solutions, your final say',
    description: 'Shadow completes tasks ahead of time, presenting them for your review. Simply approve, tweak, or reject—its all about empowering you with a head start.',
    isRecoTask: true,
    task: {
      title: "Answer Will's email",
      tag: "Sales",
      content: [
        "Good afternoon Will,",
        "",
        "Thank you for following up. I agree that a high-level, flexible SOW makes sense as we finalize deliverables and scope. Let me know a convenient time to align on key points.",
        "",
        "Best regards,"
      ]
    }
  }
]

---

<section class="py-24 sm:py-16">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    {features.map((feature, index) => (
      <div class="relative isolate overflow-hidden py-12 sm:py-32 mb-32">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-24">
          <div class="bg-[#0d1117] rounded-xl overflow-hidden border border-gray-800">
            <div class="flex items-center justify-between px-4 py-2 bg-[#161b22] border-b border-gray-800">
              <div class="flex space-x-2">
                <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
              </div>
              <div class="text-sm text-gray-400 font-mono">Shadow</div>
            </div>
            {feature.isTaskList && (
              <div class="p-6 space-y-4">
                <h4 class="text-gray-400 font-medium">To-do this week</h4>
                {feature.tasks.map((task, index) => (
                  <div 
                    class="task-card opacity-0 -translate-y-4 bg-black/40 rounded-xl p-4 transition-all duration-500" 
                    style={`transition-delay: ${index * 200}ms`}
                  >
                    <div class="flex items-center gap-3">
                      {task.urgent && (
                        <span class="px-2 py-0.5 text-xs font-medium bg-pink-500/20 text-pink-500 rounded-full">
                          Urgent
                        </span>
                      )}
                      <span class="px-2 py-0.5 text-xs font-medium bg-gray-500/20 text-gray-300 rounded-full">
                        {task.tag}
                      </span>
                    </div>
                    <h3 class="mt-2 text-lg font-semibold text-white">
                      {task.label}
                    </h3>
                  </div>
                ))}
              </div>
            )}
            {feature.isAutoTask && (
              <div class="p-6 space-y-4">
               <h4 class="text-gray-400 font-medium">Done for you</h4>
                <div class="bg-black/40 rounded-xl p-6">
                  <div class="flex items-center gap-3 mb-4">
                    <span class="px-2 py-0.5 text-xs font-medium bg-gray-500/20 text-gray-300 rounded-full">
                      {feature.task.tag}
                    </span>
                  </div>
                  <h3 class="text-xl font-semibold text-white mb-6">
                    {feature.task.title}
                  </h3>
                  <div id="typingContent" class="space-y-4 text-gray-300">
                    <!-- Content will be typed here -->
                  </div>
                  <div id="doneButton" class="mt-8 opacity-0 transition-opacity duration-500">
                    <button class="rounded-full bg-cyan-500/20 text-cyan-400 px-4 py-2 text-sm font-medium">
                      Done in G Docs
                    </button>
                  </div>
                </div>
              </div>
            )}
            {feature.isRecoTask && (
              <div class="p-6 space-y-4">
                <h4 class="text-gray-400 font-medium">Recommended for you</h4>
                <div class="bg-black/40 rounded-xl p-6">
                  <div class="flex items-center gap-3 mb-4">
                    <span class="px-2 py-0.5 text-xs font-medium bg-gray-500/20 text-gray-300 rounded-full">
                      {feature.task.tag}
                    </span>
                  </div>
                  <h3 class="text-xl font-semibold text-white mb-6">
                    {feature.task.title}
                  </h3>
                  <div id="typingContent2" class="space-y-4 text-gray-300">
                    <!-- Content will be typed here -->
                  </div>
                  <div id="doneButton2" class="mt-8 opacity-0 transition-opacity duration-500">
                    <button class="rounded-full bg-cyan-500/20 text-cyan-400 px-4 py-2 text-sm font-medium">
                      Send email now
                    </button>
                  </div>
                </div>
              </div>
            )}
            {!feature.isTaskList && !feature.isAutoTask && !feature.isRecoTask && (
              <div class="p-6">
                <img
                  src={feature.image}
                  alt={feature.title}
                  class="w-full h-full object-contain"
                  width="400"
                  height="400"
                />
              </div>
            )}
          </div>

          <div class="flex flex-col justify-center">
            <div class="relative">
              <div class="absolute -left-8 top-0 bottom-0 w-1 bg-gradient-to-b from-blue-500 to-purple-500"></div>
              <h2 class="text-3xl font-bold tracking-tight text-white">
                {feature.title}
              </h2>
              <p class="mt-4 text-xl text-shadow-blue font-semibold">
                {feature.subtitle}
              </p>
              <p class="mt-6 text-lg leading-8 text-gray-300">
                {feature.description}
              </p>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
</section>

<style>
  .text-shadow-blue {
    color: #00BFFF;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
  }

  .task-card.show {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const content = [
    "Q1 deals (500)",
    "Miro (105), Apple (75), AWS (70), Stripe (50), Adobe (50), Zoom (40), Atlassian (30), Datadog (30), Twilio (25), Snowflake (25)",
    "",
    "Key talking points today:",
    "1. AWS (75) deal is experiencing delays due to extended legal reviews. We need to assess whether additional resources or escalations are required to expedite the process.",
    "2. Miro (105) deal has shown strong adoption in the pilot phase. Potential upsell of up to 50K. Should we prioritize this now or wait until the renewal cycle?"
  ];

  let currentLine = 0;
  let currentChar = 0;
  let typingContent = null;
  let currentP = null;
  let hasPlayed = false;

  function showDoneButton() {
    const button = document.getElementById('doneButton');
    if (button) {
      button.classList.remove('opacity-0');
    }
  }

  function typeNextChar() {
    if (!typingContent) return;

    if (currentLine < content.length) {
      if (currentChar === 0) {
        currentP = document.createElement('p');
        typingContent.appendChild(currentP);
      }

      if (currentChar < content[currentLine].length) {
        currentP.innerHTML += content[currentLine].charAt(currentChar);
        currentChar++;
        setTimeout(typeNextChar, 20);
      } else {
        currentChar = 0;
        currentLine++;
        setTimeout(typeNextChar, 50);
      }
    } else {
      // Animation is complete, show the button
      setTimeout(showDoneButton, 500);
    }
  }

  function startTyping() {
    if (hasPlayed) return;
    
    typingContent = document.getElementById('typingContent');
    const button = document.getElementById('doneButton');
    if (!typingContent || !button) return;
    
    typingContent.innerHTML = '';
    button.classList.add('opacity-0');
    currentLine = 0;
    currentChar = 0;
    hasPlayed = true;
    typeNextChar();
  }

  function setupTypingAnimation() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          startTyping();
        }
      });
    }, { threshold: 0.5 });

    const content = document.getElementById('typingContent');
    if (content) {
      observer.observe(content);
    }
  }

  function setupTaskAnimations() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('show');
        }
      });
    }, { threshold: 0.3 });

    document.querySelectorAll('.task-card').forEach(card => {
      observer.observe(card);
    });
  }

  // Run on page load
  setupTypingAnimation();
  setupTaskAnimations();

  // Run when Astro swaps pages
  document.addEventListener('astro:page-load', () => {
    hasPlayed = false;
    setupTypingAnimation();
    setupTaskAnimations();
  });

  const content2 = [
    "Good afternoon Will,",
    "",
    "Thank you for following up. I agree that a high-level, flexible SOW makes sense as we finalize deliverables and scope. Let me know a convenient time to align on key points.",
    "",
    "Best regards,"
  ];

  let currentLine2 = 0;
  let currentChar2 = 0;
  let typingContent2 = null;
  let currentP2 = null;
  let hasPlayed2 = false;

  function showDoneButton2() {
    const button = document.getElementById('doneButton2');
    if (button) {
      button.classList.remove('opacity-0');
    }
  }

  function typeNextChar2() {
    if (!typingContent2) return;

    if (currentLine2 < content2.length) {
      if (currentChar2 === 0) {
        currentP2 = document.createElement('p');
        typingContent2.appendChild(currentP2);
      }

      if (currentChar2 < content2[currentLine2].length) {
        currentP2.innerHTML += content2[currentLine2].charAt(currentChar2);
        currentChar2++;
        setTimeout(typeNextChar2, 20);
      } else {
        currentChar2 = 0;
        currentLine2++;
        setTimeout(typeNextChar2, 50);
      }
    } else {
      setTimeout(showDoneButton2, 500);
    }
  }

  function startTyping2() {
    if (hasPlayed2) return;
    
    typingContent2 = document.getElementById('typingContent2');
    const button = document.getElementById('doneButton2');
    if (!typingContent2 || !button) return;
    
    typingContent2.innerHTML = '';
    button.classList.add('opacity-0');
    currentLine2 = 0;
    currentChar2 = 0;
    hasPlayed2 = true;
    typeNextChar2();
  }

  function setupTypingAnimation2() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          startTyping2();
        }
      });
    }, { threshold: 0.5 });

    const content = document.getElementById('typingContent2');
    if (content) {
      observer.observe(content);
    }
  }

  // Add to existing page load handlers
  setupTypingAnimation2();
  document.addEventListener('astro:page-load', () => {
    hasPlayed2 = false;
    setupTypingAnimation2();
  });
</script>
