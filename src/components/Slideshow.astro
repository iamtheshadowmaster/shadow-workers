---
interface Slide {
  title: string;
  gradients: string;
  iconGradients: string;
}

interface Props {
  category: string;
  slides: Slide[];
}

const { category, slides } = Astro.props;
---

<div class="slideshow-container" data-category={category}>
  <!-- Slide Indicators - Now on top -->
  <div class="flex justify-center mb-8 space-x-2">
    {slides.map((_, index) => (
      <button class={`indicator ${index === 0 ? 'active' : ''}`} data-slide={index.toString()}></button>
    ))}
  </div>
  
  <div class="slides-wrapper">
    {slides.map((slide, index) => (
      <div class={`slide ${index === 0 ? 'active' : ''}`}>
        <!-- Title -->
        <h3 class="text-2xl font-bold text-white mb-8 text-center">{slide.title}</h3>
        
        <!-- Video/Demo -->
        <div class={`bg-gradient-to-br ${slide.gradients} rounded-3xl p-6 shadow-2xl`}>
          <div class="bg-black/50 backdrop-blur rounded-2xl aspect-video flex items-center justify-center">
            <div class="text-center">
              <div class={`w-16 h-16 bg-gradient-to-br ${slide.iconGradients} rounded-2xl flex items-center justify-center mb-4 mx-auto`}>
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
              <p class="text-gray-300">Watch Demo</p>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
</div>

<style>
  .slideshow-container {
    position: relative;
    max-width: 100%;
  }
  
  .slides-wrapper {
    position: relative;
    overflow: hidden;
  }
  
  .slide {
    display: none;
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
  }
  
  .slide.active {
    display: block;
    opacity: 1;
  }
  
  .slide.fade-in {
    opacity: 1;
  }
  
  .slide.fade-out {
    opacity: 0;
  }
  
  .indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.3);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .indicator:hover {
    background-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
  }
  
  .indicator.active {
    background-color: rgba(255, 255, 255, 0.9);
    transform: scale(1.2);
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .slide.active h3 {
    animation: slideIn 0.6s ease-out 0.2s both;
  }
  
  .slide.active > div {
    animation: slideIn 0.6s ease-out 0.4s both;
  }
</style>

<script>
  class Slideshow {
    container: Element;
    slides: NodeListOf<Element>;
    indicators: NodeListOf<Element>;
    currentSlide: number;
    interval: number | null;
    isTransitioning: boolean;

    constructor(container: Element) {
      this.container = container;
      this.slides = container.querySelectorAll('.slide');
      this.indicators = container.querySelectorAll('.indicator');
      this.currentSlide = 0;
      this.interval = null;
      this.isTransitioning = false;
      
      this.init();
    }
    
    init(): void {
      this.indicators.forEach((indicator: Element, index: number) => {
        indicator.addEventListener('click', () => {
          if (!this.isTransitioning) {
            this.goToSlide(index);
          }
        });
      });
      
      this.startAutoAdvance();
      
      this.container.addEventListener('mouseenter', () => this.stopAutoAdvance());
      this.container.addEventListener('mouseleave', () => this.startAutoAdvance());
    }
    
    goToSlide(index: number): void {
      if (index === this.currentSlide || this.isTransitioning) return;
      
      this.isTransitioning = true;
      
      this.slides[this.currentSlide].classList.remove('active');
      this.indicators[this.currentSlide].classList.remove('active');
      
      this.currentSlide = index;
      
      setTimeout(() => {
        this.slides[this.currentSlide].classList.add('active');
        this.indicators[this.currentSlide].classList.add('active');
        
        setTimeout(() => {
          this.isTransitioning = false;
        }, 300);
      }, 100);
    }
    
    nextSlide(): void {
      const nextIndex = (this.currentSlide + 1) % this.slides.length;
      this.goToSlide(nextIndex);
    }
    
    startAutoAdvance(): void {
      this.stopAutoAdvance();
      this.interval = setInterval(() => {
        if (!this.isTransitioning) {
          this.nextSlide();
        }
      }, 15000) as unknown as number;
    }
    
    stopAutoAdvance(): void {
      if (this.interval) {
        clearInterval(this.interval);
        this.interval = null;
      }
    }
  }
  
  function initializeSlideshows(): void {
    const slideshowContainers = document.querySelectorAll('.slideshow-container');
    slideshowContainers.forEach((container: Element) => {
      new Slideshow(container);
    });
  }
  
  document.addEventListener('DOMContentLoaded', initializeSlideshows);
  
  if (document.readyState !== 'loading') {
    initializeSlideshows();
  }
</script>