---
import DiscoverSkillsVisual from './visuals/DiscoverSkillsVisual.astro';
import VibeCodeVisual from './visuals/VibeCodeVisual.astro';
import OneClickInstallVisual from './visuals/OneClickInstallVisual.astro';
import ManageTeamVisual from './visuals/ManageTeamVisual.astro';
---

<section class="relative bg-[#111111] py-24 overflow-hidden">
  <!-- Ambient background effects -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 -left-1/4 w-96 h-96 bg-white/3 rounded-full blur-3xl animate-pulse-slow"></div>
    <div class="absolute bottom-1/4 -right-1/4 w-96 h-96 bg-white/2 rounded-full blur-3xl animate-pulse-slow-delayed"></div>
  </div>

  <div class="max-w-7xl mx-auto px-6 relative">
    <!-- Title -->
    <div class="text-center mb-20 animate-fade-in-up">
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/95 backdrop-blur-sm rounded-full mb-6 shadow-lg">
        <div class="w-2 h-2 rounded-full bg-black animate-pulse-gentle"></div>
        <span class="text-sm font-semibold text-black uppercase tracking-wider">How it works</span>
      </div>
      <h2 class="text-xl md:text-3xl lg:text-4xl font-semibold text-white mb-6 leading-tight tracking-tight">
        Four steps to supercharge your Claude
      </h2>
    </div>

    <!-- Single Panel with Menu and Visual -->
    <div class="features-container">

      <!-- Left: Feature Menu (Accordion) -->
      <div class="features-menu">
        <button class="feature-item active" data-feature="discover" data-index="1" style="animation-delay: 0ms">
          <div class="feature-number">01</div>
          <div class="feature-header">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/>
                <path d="M20 3v4"/>
                <path d="M22 5h-4"/>
                <path d="M4 17v2"/>
                <path d="M5 18H3"/>
              </svg>
            </div>
            <div class="feature-text">
              <h3 class="feature-item-title">Choose skills made for you</h3>
              <div class="feature-description-wrapper">
                <p class="feature-item-description">Get recommended skills based on your profile and company data</p>
              </div>
            </div>
          </div>
          <div class="feature-glow"></div>
        </button>

        <button class="feature-item" data-feature="vibe" data-index="2" style="animation-delay: 100ms">
          <div class="feature-number">02</div>
          <div class="feature-header">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 4h1a3 3 0 0 1 3 3 3 3 0 0 1 3-3h1"/>
                <path d="M13 20h-1a3 3 0 0 1-3-3 3 3 0 0 1-3 3H5"/>
                <path d="M5 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1"/>
                <path d="M13 8h7a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-7"/>
                <path d="M9 7v10"/>
              </svg>
            </div>
            <div class="feature-text">
              <h3 class="feature-item-title">Vibe create new skills</h3>
              <div class="feature-description-wrapper">
                <p class="feature-item-description">Build custom skills by just talking to Shadow</p>
              </div>
            </div>
          </div>
          <div class="feature-glow"></div>
        </button>

        <button class="feature-item" data-feature="install" data-index="3" style="animation-delay: 200ms">
          <div class="feature-number">03</div>
          <div class="feature-header">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                <polyline points="16 6 12 2 8 6"/>
                <line x1="12" x2="12" y1="2" y2="15"/>
              </svg>
            </div>
            <div class="feature-text">
              <h3 class="feature-item-title">Install in one-click</h3>
              <div class="feature-description-wrapper">
                <p class="feature-item-description">Install skills to Claude with our Chrome extension</p>
              </div>
            </div>
          </div>
          <div class="feature-glow"></div>
        </button>

        <button class="feature-item" data-feature="manage" data-index="4" style="animation-delay: 300ms">
          <div class="feature-number">04</div>
          <div class="feature-header">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/>
                <line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/>
              </svg>
            </div>
            <div class="feature-text">
              <h3 class="feature-item-title">Deploy to your teams</h3>
              <div class="feature-description-wrapper">
                <p class="feature-item-description">Deploy skills across your entire team</p>
              </div>
            </div>
          </div>
          <div class="feature-glow"></div>
        </button>
      </div>

      <!-- Right: Visual Display -->
      <div class="features-visual">
        <div class="visual-content active" data-visual="discover">
          <DiscoverSkillsVisual />
        </div>

        <div class="visual-content" data-visual="vibe">
          <VibeCodeVisual />
        </div>

        <div class="visual-content" data-visual="install">
          <OneClickInstallVisual />
        </div>

        <div class="visual-content" data-visual="manage">
          <ManageTeamVisual />
        </div>
      </div>

    </div>
  </div>
</section>

<script>
  // Feature switching functionality with enhanced animations
  const featureItems = document.querySelectorAll<HTMLButtonElement>('.feature-item');
  const visualContents = document.querySelectorAll<HTMLDivElement>('.visual-content');

  featureItems.forEach(item => {
    item.addEventListener('click', () => {
      const feature = item.dataset.feature;

      // Update active states on menu items
      featureItems.forEach(fi => {
        fi.classList.remove('active');
        fi.classList.remove('transitioning');
      });
      item.classList.add('active');

      // Update active states on visuals with scale effect
      visualContents.forEach(vc => {
        if (vc.classList.contains('active')) {
          vc.classList.add('transitioning-out');
        }
        vc.classList.remove('active');
      });

      const targetVisual = document.querySelector<HTMLDivElement>(`[data-visual="${feature}"]`);
      if (targetVisual) {
        setTimeout(() => {
          visualContents.forEach(vc => vc.classList.remove('transitioning-out'));
          targetVisual.classList.add('active');
        }, 150);
      }
    });

    // Magnetic effect on hover
    item.addEventListener('mouseenter', () => {
      if (!item.classList.contains('active')) {
        item.style.transform = 'translateX(4px)';
      }
    });

    item.addEventListener('mouseleave', () => {
      item.style.transform = '';
    });
  });
</script>

<style>
  /* Animations */
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse-slow {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.1); }
  }

  @keyframes pulse-slow-delayed {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(1.15); }
  }

  @keyframes pulse-gentle {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 1; }
  }

  @keyframes float-orb {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -20px) scale(1.1); }
    66% { transform: translate(-20px, 30px) scale(0.9); }
  }

  @keyframes glow-pulse {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
  }

  .animate-fade-in-up {
    animation: fade-in-up 0.8s ease-out;
  }

  .animate-pulse-slow {
    animation: pulse-slow 8s ease-in-out infinite;
  }

  .animate-pulse-slow-delayed {
    animation: pulse-slow-delayed 10s ease-in-out infinite;
  }

  .animate-pulse-gentle {
    animation: pulse-gentle 2s ease-in-out infinite;
  }

  /* Container */
  .features-container {
    display: grid;
    grid-template-columns: 440px 1fr;
    gap: 4rem;
    align-items: start;
    animation: fade-in-up 0.8s ease-out 0.3s both;
  }

  /* Features Menu (Left) */
  .features-menu {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .feature-item {
    position: relative;
    display: flex;
    flex-direction: column;
    padding: 0;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 1rem;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    text-align: left;
    width: 100%;
    overflow: hidden;
    animation: fade-in-up 0.6s ease-out both;
    backdrop-filter: blur(10px);
  }

  .feature-item:hover {
    background: rgba(255, 255, 255, 0.04);
    border-color: rgba(255, 255, 255, 0.12);
    transform: translateX(4px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  .feature-item.active {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.25);
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.15),
                0 8px 32px rgba(255, 255, 255, 0.1),
                0 0 60px rgba(255, 255, 255, 0.05);
  }

  .feature-item.active .feature-glow {
    opacity: 1;
  }

  .feature-glow {
    position: absolute;
    inset: -1px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
    border-radius: 1rem;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
    z-index: -1;
    filter: blur(8px);
  }

  .feature-number {
    position: absolute;
    top: 1.25rem;
    right: 1.5rem;
    font-size: 0.75rem;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.15);
    letter-spacing: 0.05em;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .feature-item:hover .feature-number,
  .feature-item.active .feature-number {
    color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
  }

  .feature-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    width: 100%;
  }

  .feature-item.active .feature-header {
    align-items: flex-start;
  }

  .feature-icon {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .feature-item:hover .feature-icon {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.15);
    color: rgba(255, 255, 255, 0.7);
    transform: scale(1.05) rotate(-2deg);
  }

  .feature-item.active .feature-icon {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.25);
    color: rgba(255, 255, 255, 0.95);
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
  }

  .feature-text {
    flex: 1;
    min-width: 0;
  }

  .feature-item-title {
    font-size: 1.0625rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.4;
    transition: color 0.3s ease;
    margin-bottom: 0.5rem;
  }

  .feature-item:hover .feature-item-title {
    color: rgba(255, 255, 255, 0.95);
  }

  .feature-item.active .feature-item-title {
    color: white;
  }

  .feature-description-wrapper {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.4s ease,
                margin-top 0.4s ease;
    opacity: 0;
  }

  .feature-item.active .feature-description-wrapper {
    max-height: 200px;
    opacity: 1;
    margin-top: 0.25rem;
  }

  .feature-item-description {
    font-size: 0.9375rem;
    color: rgba(255, 255, 255, 0.5);
    line-height: 1.6;
    transition: color 0.3s ease;
  }

  .feature-item.active .feature-item-description {
    color: rgba(255, 255, 255, 0.7);
  }

  /* Features Visual (Right) */
  .features-visual {
    position: relative;
    min-height: 600px;
  }

  .visual-content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
    transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .visual-content.active {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
  }

  .visual-content.transitioning-out {
    opacity: 0;
    transform: scale(1.02);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .visual-placeholder {
    position: relative;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 1.5rem;
    padding: 4rem;
    min-height: 600px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* Animated gradient orbs */
  .gradient-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(60px);
    opacity: 0.3;
    pointer-events: none;
  }

  .orb-1 {
    width: 300px;
    height: 300px;
    top: -100px;
    left: -100px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, transparent 70%);
    animation: float-orb 20s ease-in-out infinite;
  }

  .orb-2 {
    width: 250px;
    height: 250px;
    bottom: -80px;
    right: -80px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.06) 0%, transparent 70%);
    animation: float-orb 25s ease-in-out infinite reverse;
  }

  .orb-3 {
    width: 200px;
    height: 200px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(255, 255, 255, 0.04) 0%, transparent 70%);
    animation: float-orb 30s ease-in-out infinite;
    animation-delay: -5s;
  }

  .placeholder-content {
    position: relative;
    z-index: 1;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }

  .placeholder-icon {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1.25rem;
    color: rgba(255, 255, 255, 0.4);
    margin-bottom: 0.5rem;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .visual-content.active .placeholder-icon {
    animation: fade-in-up 0.8s ease-out 0.2s both;
  }

  .placeholder-text {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.5rem;
    font-weight: 600;
    text-align: center;
    letter-spacing: -0.02em;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .visual-content.active .placeholder-text {
    animation: fade-in-up 0.8s ease-out 0.3s both;
  }

  .placeholder-subtext {
    color: rgba(255, 255, 255, 0.5);
    font-size: 1rem;
    font-weight: 400;
    text-align: center;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .visual-content.active .placeholder-subtext {
    animation: fade-in-up 0.8s ease-out 0.4s both;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .features-container {
      grid-template-columns: 1fr;
      gap: 3rem;
    }

    .features-visual {
      min-height: 500px;
    }

    .visual-placeholder {
      min-height: 500px;
      padding: 3rem;
    }
  }

  @media (max-width: 768px) {
    .feature-item {
      border-radius: 0.875rem;
    }

    .feature-header {
      padding: 1.25rem;
      gap: 0.875rem;
    }

    .feature-icon {
      width: 44px;
      height: 44px;
    }

    .feature-icon svg {
      width: 22px;
      height: 22px;
    }

    .feature-item-title {
      font-size: 1rem;
    }

    .feature-item-description {
      font-size: 0.875rem;
    }

    .feature-number {
      top: 1rem;
      right: 1.25rem;
    }

    .features-visual {
      min-height: 400px;
    }

    .visual-placeholder {
      min-height: 400px;
      padding: 2.5rem;
      border-radius: 1.25rem;
    }

    .placeholder-icon {
      width: 64px;
      height: 64px;
    }

    .placeholder-icon svg {
      width: 48px;
      height: 48px;
    }

    .placeholder-text {
      font-size: 1.25rem;
    }

    .placeholder-subtext {
      font-size: 0.9375rem;
    }

    .gradient-orb {
      filter: blur(40px);
    }
  }
</style>
