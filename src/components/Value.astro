---
interface Props {
  title: string;
  subtitle: string;
  backgroundColor?: string;
}

const { title, subtitle, backgroundColor = "bg-gradient-to-b from-black to-gray-900" } = Astro.props;
---

<section class={`${backgroundColor}`}>
  <div class="max-w-6xl mx-auto px-6">
    
    <!-- Scroll-Triggered Transform Section -->
    <div class="h-[200vh] relative" id="scrollTrigger">
      <!-- Sticky container that holds the animation -->
      <div class="sticky top-0 h-screen flex flex-col items-center justify-start pt-20 overflow-hidden text-center">
        
        <!-- Title and subtitle - always visible and sticky -->
        <div class="mb-16">
          <h2 class="text-4xl md:text-5xl font-bold text-white mb-6">{title}</h2>
          <p class="text-xl text-gray-300">{subtitle}</p>
        </div>
        
        <!-- Content that transforms -->
        <div class="relative w-full max-w-2xl" id="transformContent">
          
          <!-- Slack State -->
          <div class="absolute inset-0 transform-state" id="slackCard">
            <div class="bg-red-900/20 border border-red-800/30 rounded-3xl p-12 flex items-center justify-center relative overflow-hidden">
              <div class="absolute inset-0 opacity-15">
                <!-- Scattered notification icons -->
                <div class="scattered-icons">
                  <div class="icon notification" style="top: 8%; left: 12%;">üìß</div>
                  <div class="icon notification" style="top: 18%; left: 75%;">üí¨</div>
                  <div class="icon notification" style="top: 35%; left: 15%;">‚ùó</div>
                  <div class="icon notification" style="top: 42%; left: 85%;">üìÖ</div>
                  <div class="icon notification" style="top: 65%; left: 25%;">‚ö†Ô∏è</div>
                  <div class="icon notification" style="top: 75%; left: 70%;">üî•</div>
                  <div class="icon notification" style="top: 88%; left: 45%;">üíÄ</div>
                </div>
              </div>
              <div class="text-center relative z-10">
                <div class="mb-6">
                  <img src="/images/shadow-sad.png" alt="Shadow Sad" class="h-24 mx-auto" />
                </div>
                <h3 class="text-3xl font-bold text-red-300 mb-4">With Slack</h3>
                <p class="text-lg text-gray-400">Everything gets lost in the chaos</p>
              </div>
            </div>
          </div>
          
          <!-- Shadow State -->
          <div class="absolute inset-0 transform-state opacity-0" id="shadowCard">
            <div class="bg-green-900/20 border border-green-800/30 rounded-3xl p-12 flex items-center justify-center relative overflow-hidden">
              <div class="absolute inset-0 opacity-25">
                <!-- Organized grid of icons -->
                <div class="organized-grid">
                  <div class="grid grid-cols-4 gap-6 p-8">
                    <div class="organized-item">‚úÖ</div>
                    <div class="organized-item">üìù</div>
                    <div class="organized-item">üéØ</div>
                    <div class="organized-item">üìä</div>
                    <div class="organized-item">üîç</div>
                    <div class="organized-item">‚è∞</div>
                    <div class="organized-item">üí°</div>
                    <div class="organized-item">üöÄ</div>
                  </div>
                </div>
              </div>
              <div class="text-center relative z-10">
                <div class="mb-6">
                  <img src="/images/shadow-happy.png" alt="Shadow Happy" class="h-24 mx-auto" />
                </div>
                <h3 class="text-3xl font-bold text-green-300 mb-4">With Shadow</h3>
                <p class="text-lg text-gray-400">Everything organized and accessible</p>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- Benefits List - appears after the scroll animation -->
    <div class="text-center -mt-16">
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-4xl mx-auto">
        <div class="benefit-item">
          <div class="benefit-icon">
            <img src="/images/shadow-deadline.png" alt="Shadow Deadline" class="h-14 mx-auto" />
          </div>
          <h4 class="text-white font-semibold mb-2">Never miss deadlines</h4>
          <p class="text-gray-400 text-sm">Every task tracked with context</p>
        </div>
        
        <div class="benefit-item">
          <div class="benefit-icon">
            <img src="/images/shadow-smart.png" alt="Shadow Smart" class="h-14 mx-auto" />
          </div>
          <h4 class="text-white font-semibold mb-2">Remember everything</h4>
          <p class="text-gray-400 text-sm">Decisions instantly searchable</p>
        </div>
        
        <div class="benefit-item">
          <div class="benefit-icon">
            <img src="/images/shadow-fast.png" alt="Shadow Smart" class="h-14 mx-auto" />
          </div>
          <h4 class="text-white font-semibold mb-2">Move faster</h4>
          <p class="text-gray-400 text-sm">No more "what was that about?"</p>
        </div>
        
        <div class="benefit-item">
          <div class="benefit-icon">
            <img src="/images/shadow-sane.png" alt="Shadow Smart" class="h-14 mx-auto" />
          </div>
          <h4 class="text-white font-semibold mb-2">Stay sane</h4>
          <p class="text-gray-400 text-sm">Work flows, mind stays clear</p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .transform-state {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  .scattered-icons {
    position: relative;
    width: 100%;
    height: 100%;
  }
  
  .icon.notification {
    position: absolute;
    font-size: 32px;
    animation: float 4s ease-in-out infinite;
    filter: blur(0.5px);
  }
  
  .icon.notification:nth-child(2) { animation-delay: -1s; }
  .icon.notification:nth-child(3) { animation-delay: -2s; }
  .icon.notification:nth-child(4) { animation-delay: -0.5s; }
  .icon.notification:nth-child(5) { animation-delay: -1.5s; }
  .icon.notification:nth-child(6) { animation-delay: -2.5s; }
  .icon.notification:nth-child(7) { animation-delay: -3s; }
  
  @keyframes float {
    0%, 100% {
      transform: translateY(0px) rotate(0deg);
      opacity: 0.4;
    }
    50% {
      transform: translateY(-15px) rotate(8deg);
      opacity: 0.9;
    }
  }
  
  .organized-item {
    font-size: 24px;
    text-align: center;
    opacity: 0.7;
    animation: pulse 3s ease-in-out infinite;
  }
  
  .organized-item:nth-child(odd) { animation-delay: -1.5s; }
  .organized-item:nth-child(even) { animation-delay: -0.5s; }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 0.7;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(1.15);
    }
  }
  
  .benefit-item {
    text-align: center;
    padding: 1.5rem;
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }
  
  .benefit-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }
  
  .benefit-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: block;
  }
</style>

<script>
  function initScrollTransform() {
    const scrollTrigger = document.getElementById('scrollTrigger');
    const slackCard = document.getElementById('slackCard');
    const shadowCard = document.getElementById('shadowCard');
    
    if (!scrollTrigger || !slackCard || !shadowCard) return;
    
    // Use scroll event listener for smooth, real-time updates
    let ticking = false;
    
    function updateTransform() {
      const rect = scrollTrigger.getBoundingClientRect();
      const scrollTriggerHeight = scrollTrigger.offsetHeight;
      const windowHeight = window.innerHeight;
      
      // More precise progress calculation based on viewport position
      // Start when section is fully in view, end when section is leaving viewport
      let progress = 0;
      
      if (rect.top <= 0 && rect.bottom > windowHeight) {
        // Section is active (sticky content is showing)
        const scrolledDistance = Math.abs(rect.top);
        const totalScrollDistance = scrollTriggerHeight - windowHeight;
        progress = Math.min(scrolledDistance / totalScrollDistance, 1);
      } else if (rect.bottom <= windowHeight && rect.bottom > 0) {
        // Section has been scrolled through completely
        progress = 1;
      }
      
      // Debug logging
      console.log(`Scroll progress: ${progress.toFixed(2)}, rect.top: ${rect.top.toFixed(0)}, rect.bottom: ${rect.bottom.toFixed(0)}`);
      
      // Apply transform based on progress with more gradual transition
      if (progress <= 0.2) {
        // Show Slack state
        slackCard.style.opacity = '1';
        shadowCard.style.opacity = '0';
      } else if (progress <= 0.8) {
        // Transition phase - longer transition zone
        const transitionProgress = (progress - 0.2) / 0.6;
        slackCard.style.opacity = `${1 - transitionProgress}`;
        shadowCard.style.opacity = `${transitionProgress}`;
      } else {
        // Show Shadow state
        slackCard.style.opacity = '0';
        shadowCard.style.opacity = '1';
      }
      
      ticking = false;
    }
    
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(updateTransform);
        ticking = true;
      }
    });
  }
  
  // Initialize on DOM ready
  document.addEventListener('DOMContentLoaded', initScrollTransform);
  
  // Initialize if DOM is already loaded
  if (document.readyState !== 'loading') {
    initScrollTransform();
  }
</script>